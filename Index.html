<!DOCTYPE html>
<html>
<head>
    <title>VR Whack-a-Mole Game</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <style>
        #ui {
            position: fixed;
            top: 10px;
            left: 10px;
            color: white;
            font-family: Arial;
            font-size: 20px;
            z-index: 100;
        }
    </style>
</head>
<body>
    <div id="ui">
        <div>Score: <span id="score">0</span></div>
        <div>Time: <span id="timer">30</span>s</div>
    </div>

    <a-scene background="color: #87CEEB">
        <!-- Camera with cursor for interaction -->
        <a-camera>
            <a-cursor 
                position="0 0 -1"
                geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                material="color: white; shader: flat"
                cursor="fuse: true; fuseTimeout: 1000">
            </a-cursor>
        </a-camera>

        <!-- Ground -->
        <a-plane 
            position="0 0 -4" 
            rotation="-90 0 0" 
            width="10" 
            height="10" 
            color="#4CC417">
        </a-plane>

        <!-- Mole positions (9 holes in a 3x3 grid) -->
        <a-entity id="mole-1" position="-2 0.5 -3" visible="false"></a-entity>
        <a-entity id="mole-2" position="0 0.5 -3" visible="false"></a-entity>
        <a-entity id="mole-3" position="2 0.5 -3" visible="false"></a-entity>
        <a-entity id="mole-4" position="-2 0.5 -4" visible="false"></a-entity>
        <a-entity id="mole-5" position="0 0.5 -4" visible="false"></a-entity>
        <a-entity id="mole-6" position="2 0.5 -4" visible="false"></a-entity>
        <a-entity id="mole-7" position="-2 0.5 -5" visible="false"></a-entity>
        <a-entity id="mole-8" position="0 0.5 -5" visible="false"></a-entity>
        <a-entity id="mole-9" position="2 0.5 -5" visible="false"></a-entity>

        <!-- Holes in the ground -->
        <a-circle position="-2 0.01 -3" rotation="-90 0 0" radius="0.3" color="#654321"></a-circle>
        <a-circle position="0 0.01 -3" rotation="-90 0 0" radius="0.3" color="#654321"></a-circle>
        <a-circle position="2 0.01 -3" rotation="-90 0 0" radius="0.3" color="#654321"></a-circle>
        <a-circle position="-2 0.01 -4" rotation="-90 0 0" radius="0.3" color="#654321"></a-circle>
        <a-circle position="0 0.01 -4" rotation="-90 0 0" radius="0.3" color="#654321"></a-circle>
        <a-circle position="2 0.01 -4" rotation="-90 0 0" radius="0.3" color="#654321"></a-circle>
        <a-circle position="-2 0.01 -5" rotation="-90 0 0" radius="0.3" color="#654321"></a-circle>
        <a-circle position="0 0.01 -5" rotation="-90 0 0" radius="0.3" color="#654321"></a-circle>
        <a-circle position="2 0.01 -5" rotation="-90 0 0" radius="0.3" color="#654321"></a-circle>

        <!-- Lighting -->
        <a-light type="ambient" color="#404040"></a-light>
        <a-light type="directional" position="0 10 0" color="#ffffff"></a-light>
    </a-scene>

    <script>
        // Game variables
        let score = 0;
        let timeLeft = 30;
        let gameActive = false;
        let activeMoles = [];

        // Get DOM elements
        const scoreElement = document.getElementById('score');
        const timerElement = document.getElementById('timer');

        // Mole types and colors
        const moleTypes = [
            { geometry: 'box', color: '#8B4513', size: '0.3 0.3 0.3' },
            { geometry: 'sphere', color: '#654321', size: '0.2' }
        ];

        // Start the game
        function startGame() {
            gameActive = true;
            score = 0;
            timeLeft = 30;
            updateUI();
            
            // Start the timer
            const gameTimer = setInterval(() => {
                timeLeft--;
                updateUI();
                
                if (timeLeft <= 0) {
                    endGame();
                    clearInterval(gameTimer);
                }
            }, 1000);
            
            // Start spawning moles
            spawnMoles();
        }

        // Spawn moles randomly
        function spawnMoles() {
            if (!gameActive) return;
            
            // Random delay between mole spawns
            const delay = Math.random() * 2000 + 1000; // 1-3 seconds
            
            setTimeout(() => {
                if (gameActive) {
                    createMole();
                    spawnMoles(); // Continue spawning
                }
            }, delay);
        }

        // Create a mole at random position
        function createMole() {
            const molePositions = [];
            for (let i = 1; i <= 9; i++) {
                const moleEntity = document.getElementById(`mole-${i}`);
                if (!moleEntity.hasChildNodes()) {
                    molePositions.push(i);
                }
            }
            
            if (molePositions.length === 0) return;
            
            const randomPosition = molePositions[Math.floor(Math.random() * molePositions.length)];
            const moleEntity = document.getElementById(`mole-${randomPosition}`);
            const moleType = moleTypes[Math.floor(Math.random() * moleTypes.length)];
            
            // Create mole element
            const mole = document.createElement(`a-${moleType.geometry}`);
            
            if (moleType.geometry === 'box') {
                mole.setAttribute('geometry', `width: 0.3; height: 0.3; depth: 0.3`);
            } else {
                mole.setAttribute('geometry', `radius: 0.2`);
            }
            
            mole.setAttribute('material', `color: ${moleType.color}`);
            mole.setAttribute('animation', 'property: position; to: 0 0 0; dur: 300');
            mole.setAttribute('animation__hide', 'property: position; to: 0 -0.5 0; dur: 300; startEvents: hide');
            mole.classList.add('mole');
            
            // Add click/gaze interaction
            mole.addEventListener('click', function() {
                hitMole(this);
            });
            
            moleEntity.appendChild(mole);
            moleEntity.setAttribute('visible', 'true');
            
            // Hide mole after 2 seconds if not hit
            setTimeout(() => {
                if (mole.parentNode) {
                    hideMole(mole);
                }
            }, 2000);
        }

        // Hit mole function
        function hitMole(mole) {
            if (!gameActive) return;
            
            score += 10;
            updateUI();
            
            // Visual feedback
            mole.setAttribute('animation', 'property: scale; to: 1.5 1.5 1.5; dur: 200');
            mole.setAttribute('material', 'color: #ff0000');
            
            setTimeout(() => {
                hideMole(mole);
            }, 200);
        }

        // Hide mole
        function hideMole(mole) {
            if (mole && mole.parentNode) {
                mole.parentNode.setAttribute('visible', 'false');
                mole.parentNode.removeChild(mole);
            }
        }

        // Update UI
        function updateUI() {
            scoreElement.textContent = score;
            timerElement.textContent = timeLeft;
        }

        // End game
        function endGame() {
            gameActive = false;
            
            // Clear all moles
            for (let i = 1; i <= 9; i++) {
                const moleEntity = document.getElementById(`mole-${i}`);
                if (moleEntity.hasChildNodes()) {
                    moleEntity.removeChild(moleEntity.firstChild);
                }
                moleEntity.setAttribute('visible', 'false');
            }
            
            alert(`Game Over! Final Score: ${score}`);
        }

        // Start the game when page loads
        window.addEventListener('load', () => {
            setTimeout(startGame, 1000);
        });
    </script>
</body>
</html>
