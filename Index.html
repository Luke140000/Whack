<!DOCTYPE html>
<html>
<head>
    <title>VR Whack-a-Mole Game</title>
    <script src="https://aframe.io/releases/1.7.0/aframe.min.js"></script>
    <style>
        #ui {
            position: fixed;
            top: 10px;
            left: 10px;
            color: white;
            font-family: Arial;
            font-size: 20px;
            z-index: 100;
            background: rgba(0,0,0,0.5);
            padding: 10px;
        }
    </style>
</head>
<body>
    <div id="ui">
        <div>Score: <span id="score">0</span></div>
        <div>Time: <span id="timer">30</span>s</div>
        <div>Debug: <span id="debug">Starting...</span></div>
    </div>

    <a-scene background="color: #87CEEB">
        <!-- Camera with cursor for interaction -->
        <a-camera>
            <a-cursor 
                position="0 0 -1"
                geometry="primitive: ring; radiusInner: 0.02; radiusOuter: 0.03"
                material="color: white; shader: flat"
                cursor="fuse: true; fuseTimeout: 1000">
            </a-cursor>
        </a-camera>

        <!-- Ground -->
        <a-plane 
            position="0 0 -4" 
            rotation="-90 0 0" 
            width="10" 
            height="10" 
            color="#4CC417">
        </a-plane>

        <!-- Mole positions -->
        <a-entity id="mole-1" position="-2 0 -3"></a-entity>
        <a-entity id="mole-2" position="0 0 -3"></a-entity>
        <a-entity id="mole-3" position="2 0 -3"></a-entity>
        <a-entity id="mole-4" position="-2 0 -4"></a-entity>
        <a-entity id="mole-5" position="0 0 -4"></a-entity>
        <a-entity id="mole-6" position="2 0 -4"></a-entity>
        <a-entity id="mole-7" position="-2 0 -5"></a-entity>
        <a-entity id="mole-8" position="0 0 -5"></a-entity>
        <a-entity id="mole-9" position="2 0 -5"></a-entity>

        <!-- Holes -->
        <a-circle position="-2 0.01 -3" rotation="-90 0 0" radius="0.3" color="#654321"></a-circle>
        <a-circle position="0 0.01 -3" rotation="-90 0 0" radius="0.3" color="#654321"></a-circle>
        <a-circle position="2 0.01 -3" rotation="-90 0 0" radius="0.3" color="#654321"></a-circle>
        <a-circle position="-2 0.01 -4" rotation="-90 0 0" radius="0.3" color="#654321"></a-circle>
        <a-circle position="0 0.01 -4" rotation="-90 0 0" radius="0.3" color="#654321"></a-circle>
        <a-circle position="2 0.01 -4" rotation="-90 0 0" radius="0.3" color="#654321"></a-circle>
        <a-circle position="-2 0.01 -5" rotation="-90 0 0" radius="0.3" color="#654321"></a-circle>
        <a-circle position="0 0.01 -5" rotation="-90 0 0" radius="0.3" color="#654321"></a-circle>
        <a-circle position="2 0.01 -5" rotation="-90 0 0" radius="0.3" color="#654321"></a-circle>

        <!-- Lighting -->
        <a-light type="ambient" color="#404040"></a-light>
        <a-light type="directional" position="0 10 0" color="#ffffff"></a-light>
    </a-scene>

    <script>
        let score = 0;
        let timeLeft = 30;
        let gameActive = false;

        const scoreElement = document.getElementById('score');
        const timerElement = document.getElementById('timer');
        const debugElement = document.getElementById('debug');

        function updateDebug(message) {
            debugElement.textContent = message;
            console.log("DEBUG: " + message);
        }

        function startGame() {
            updateDebug("Starting game...");
            gameActive = true;
            score = 0;
            timeLeft = 30;
            updateUI();
            
            const gameTimer = setInterval(() => {
                timeLeft--;
                updateUI();
                if (timeLeft <= 0) {
                    gameActive = false;
                    clearInterval(gameTimer);
                    alert(`Game Over! Score: ${score}`);
                }
            }, 1000);
            
            spawnMoles();
        }

        function spawnMoles() {
            if (!gameActive) return;
            
            updateDebug("Spawning mole...");
            createMole();
            
            setTimeout(() => {
                if (gameActive) spawnMoles();
            }, 2000);
        }

        function createMole() {
            // Find available positions
            const available = [];
            for (let i = 1; i <= 9; i++) {
                const entity = document.getElementById(`mole-${i}`);
                if (entity && entity.children.length === 0) {
                    available.push(i);
                }
            }
            
            if (available.length === 0) {
                updateDebug("No positions available");
                return;
            }
            
            const pos = available[Math.floor(Math.random() * available.length)];
            const entity = document.getElementById(`mole-${pos}`);
            
            updateDebug(`Creating mole at position ${pos}`);
            
            // Create mole
            const mole = document.createElement('a-box');
            mole.setAttribute('width', '0.3');
            mole.setAttribute('height', '0.3');
            mole.setAttribute('depth', '0.3');
            mole.setAttribute('color', 'red');
            
            // Start underground and pop up
            entity.appendChild(mole);
            
            // Set initial position underground
            mole.object3D.position.set(0, -0.5, 0);
            
            updateDebug("Mole created, starting animation...");
            
            // Animate up
            const startY = -0.5;
            const endY = 0.5;
            const duration = 500;
            const startTime = Date.now();
            
            function animateUp() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                // Simple easing
                const easeProgress = 1 - Math.pow(1 - progress, 3);
                const currentY = startY + (endY - startY) * easeProgress;
                
                mole.object3D.position.y = currentY;
                
                if (progress < 1) {
                    requestAnimationFrame(animateUp);
                } else {
                    updateDebug("Pop-up animation complete");
                }
            }
            
            animateUp();
            
            // Add click handler
            mole.addEventListener('click', () => {
                if (!gameActive) return;
                score += 10;
                updateUI();
                updateDebug("Mole hit!");
                mole.setAttribute('color', 'green');
                setTimeout(() => hideMole(mole), 200);
            });
            
            // Auto hide after 3 seconds
            setTimeout(() => {
                if (mole.parentNode) {
                    hideMole(mole);
                }
            }, 3000);
        }

        function hideMole(mole) {
            if (!mole || !mole.parentNode) return;
            
            updateDebug("Hiding mole...");
            
            // Animate down
            const startY = mole.object3D.position.y;
            const endY = -0.5;
            const duration = 400;
            const startTime = Date.now();
            
            function animateDown() {
                const elapsed = Date.now() - startTime;
                const progress = Math.min(elapsed / duration, 1);
                
                const currentY = startY + (endY - startY) * progress;
                mole.object3D.position.y = currentY;
                
                if (progress < 1) {
                    requestAnimationFrame(animateDown);
                } else {
                    // Remove mole
                    if (mole.parentNode) {
                        mole.parentNode.removeChild(mole);
                    }
                    updateDebug("Mole removed");
                }
            }
            
            animateDown();
        }

        function updateUI() {
            scoreElement.textContent = score;
            timerElement.textContent = timeLeft;
        }

        // Start game
        window.addEventListener('load', () => {
            updateDebug("Page loaded, starting in 2 seconds...");
            setTimeout(startGame, 2000);
        });
    </script>
</body>
</html>
